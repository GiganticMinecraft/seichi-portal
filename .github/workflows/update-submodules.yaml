name: Update submodules
on:
  workflow_dispatch:
  # "At 00:00 on Monday."(UTC) - https://crontab.guru/#0_0_*_*_1
  schedule:
    - cron:  '0 0 * * 1'
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: "true"
      - name: Git as GitHub Actions Bot
        uses: Lucky3028/git-as-gha@v1.0.1
      - name: Update submodules
        run: |
          SUBMODULES=(frontend backend openapi)
          for module in ${SUBMODULES[@]}; do
            echo "Update submodule: $module"
            git submodule update --remote "$module"
            if ! git diff --exit-code --quiet; then
              git add "$module"
              git commit -m "chore: update submodule ($module)"
            fi
          done
          git push origin main
